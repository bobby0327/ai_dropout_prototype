<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dropout Risk Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
    <h1 class="mb-4">ðŸŽ“ Student Dropout Risk Dashboard</h1>

    <!-- Chart Section -->
    <div class="mb-5">
        <h4>Risk Tier Distribution</h4>
        <canvas id="riskChart" width="400" height="200"></canvas>
    </div>

    <!-- Filter + Search -->
    <div class="d-flex mb-3 gap-3">
        <!-- Dropdown Filter -->
        <div>
            <label for="filterTier" class="form-label">Filter by Risk Tier:</label>
            <select id="filterTier" class="form-select" style="width:200px;">
                <option value="All" selected>All</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
        </div>

        <!-- Search Bar -->
        <div>
            <label for="searchInput" class="form-label">Search by Student ID:</label>
            <input type="text" id="searchInput" class="form-control" placeholder="Enter Student ID" style="width:200px;">
        </div>
    </div>

    <!-- Table Section -->
    <table id="studentTable" class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Student ID</th>
                <th>Age</th>
                <th>Gender</th>
                <th>GPA</th>
                <th>Attendance %</th>
                <th>Risk Score</th>
                <th>Risk Tier</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr data-tier="{{ student.risk_tier }}">
                <td>{{ student.student_id }}</td>
                <td>{{ student.age }}</td>
                <td>{{ student.gender }}</td>
                <td>{{ student.gpa }}</td>
                <td>{{ student.attendance_pct }}</td>
                <td>{{ "%.2f"|format(student.risk_score) }}</td>
                <td>
                    {% if student.risk_tier == "High" %}
                        <span class="badge bg-danger">High</span>
                    {% elif student.risk_tier == "Medium" %}
                        <span class="badge bg-warning text-dark">Medium</span>
                    {% else %}
                        <span class="badge bg-success">Low</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // === PIE CHART ===
        const ctx = document.getElementById('riskChart').getContext('2d');
        const chartData = {
            labels: ['High', 'Medium', 'Low'],
            datasets: [{
                label: 'Risk Tier Distribution',
                data: [
                    {{ tier_counts.get('High', 0) }},
                    {{ tier_counts.get('Medium', 0) }},
                    {{ tier_counts.get('Low', 0) }}
                ],
                backgroundColor: ['#dc3545', '#ffc107', '#198754']
            }]
        };
        new Chart(ctx, { type: 'pie', data: chartData });

        // === FILTER FUNCTION ===
        const filterDropdown = document.getElementById("filterTier");
        const searchInput = document.getElementById("searchInput");
        const tableRows = document.querySelectorAll("#studentTable tbody tr");

        function applyFilters() {
            const selectedTier = filterDropdown.value;
            const searchText = searchInput.value.toLowerCase();

            tableRows.forEach(row => {
                const tier = row.getAttribute("data-tier");
                const studentId = row.querySelector("td").textContent.toLowerCase();

                const matchesTier = (selectedTier === "All" || tier === selectedTier);
                const matchesSearch = studentId.includes(searchText);

                if (matchesTier && matchesSearch) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        }

        filterDropdown.addEventListener("change", applyFilters);
        searchInput.addEventListener("keyup", applyFilters);
    </script>
</body>
</html>
